# תיקון שגיאת 401 בהתחברות

## הבעיה

מקבלים שגיאת 401 (Unauthorized) בעת ניסיון התחברות:
```
Failed to load resource: the server responded with a status of 401 (Unauthorized)
```

## סיבות אפשריות

שגיאת 401 יכולה להיגרם מ:

1. **משתמש לא קיים** - האימייל לא נמצא במסד הנתונים
2. **סיסמה שגויה** - הסיסמה שהוזנה לא תואמת לסיסמה במסד הנתונים
3. **משתמש ללא סיסמה** - המשתמש נרשם דרך Google בלבד
4. **אימייל לא מאומת** - האימייל לא אומת (מחזיר 403, לא 401)

## מה תוקן

1. **שיפרתי את הלוגים** - עכשיו תראו בלוגים של השרת:
   - אימייל שמנסה להתחבר
   - האם המשתמש נמצא
   - האם האימייל מאומת
   - האם יש סיסמה
   - האם הסיסמה תקינה

2. **שיפרתי את הודעות השגיאה** - עכשיו ההודעות בעברית וברורות יותר:
   - "אימייל או סיסמה שגויים" (401)
   - "האימייל לא אומת" (403)
   - "חשבון זה מחובר דרך Google בלבד" (401)

3. **שיפרתי את הטיפול בשגיאות ב-Frontend** - עכשיו יש לוגים מפורטים יותר

## איך לבדוק מה הבעיה

1. **פתחו את הקונסול של הדפדפן** (F12)
2. **פתחו את הטרמינל של השרת** (Backend)
3. **נסו להתחבר** - תראו בלוגים:
   ```
   🔐 Login attempt for: [email]
   ✅ User found: [email], emailVerified: true/false, hasPassword: true/false
   🔑 Comparing password for: [email]
   ✅ Password valid for: [email]
   ✅ Login successful for: [email]
   ```

## פתרונות לפי סוג הבעיה

### אם המשתמש לא נמצא:
```
❌ User not found: [email]
```
**פתרון:** ודאו שהמשתמש נרשם. אם נרשם, בדקו את האימייל.

### אם הסיסמה שגויה:
```
❌ Invalid password for: [email]
```
**פתרון:** ודאו שהסיסמה נכונה. אפשר לאפס סיסמה דרך "שכחתי סיסמה".

### אם האימייל לא מאומת:
```
⚠️  Email not verified: [email]
```
**פתרון:** 
1. לכו לדף ההרשמה
2. הזינו את האימייל והסיסמה
3. לחצו על "שלח קוד אימות"
4. הזינו את הקוד שקיבלתם במייל

### אם המשתמש ללא סיסמה (Google-only):
```
⚠️  User has no password (Google-only): [email]
```
**פתרון:** השתמשו בכפתור "התחברות עם Google" במקום סיסמה.

## בדיקות נוספות

אם עדיין יש בעיה, בדקו:

1. **האם השרת רץ?**
   ```bash
   # בדקו שהשרת רץ על פורט 5000
   curl http://localhost:5000/api/auth/verify
   ```

2. **האם המסד נתונים מחובר?**
   ```bash
   # בדקו את הלוגים של השרת
   # אמור להיות: "Server running on port 5000"
   ```

3. **האם יש שגיאות בלוגים?**
   - בדקו את הקונסול של הדפדפן
   - בדקו את הטרמינל של השרת

## אם צריך לאמת משתמש ידנית

אם האימייל לא מאומת ואתם רוצים לאמת אותו ידנית:

```bash
cd backend
node verify-user.js
```

או דרך Prisma Studio:
```bash
cd backend
npx prisma studio
```

ואז עדכנו את `emailVerified` ל-`true` עבור המשתמש.

---

**תאריך עדכון:** ינואר 2025
